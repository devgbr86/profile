<!DOCTYPE html>
<html lang="pt-BR">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta name="description" content="@devcaffe">
     <link rel="icon" href="./img/favcoreicon.svg" type="image/svg+xml">
     <title>@devcaffe</title>

     <!-- Tailwind CSS -->
     <script src="https://cdn.tailwindcss.com"></script>

     <!-- Marked.js -->
     <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

     <!-- Highlight.js -->
     <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

     <!-- DOMPurify -->
     <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

     <!-- Font -->
     <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

     <style>
          * {
               margin: 0;
               padding: 0;
               box-sizing: border-box;
          }

          :root {
               --bg: #f5f5f5;
               --fg: #000;
               --accent: #ff8c00;
               --card-bg: #fff;
               --border: #000;
               --code-bg: #282c34;
          }

          html {
               scroll-behavior: smooth;
          }

          body {
               font-family: 'Roboto Mono', monospace;
               background-color: var(--bg);
               color: var(--fg);
               line-height: 1.6;
               display: flex;
               flex-direction: column;
               min-height: 100vh;
          }

          /* NAVBAR TOP */
          .navbar {
               position: fixed;
               top: 0;
               left: 0;
               width: 100%;
               background-color: #000;
               color: #fff;
               display: flex;
               align-items: center;
               justify-content: space-between;
               padding: 12px 24px;
               border-bottom: 1px solid var(--accent);
               z-index: 1000;
          }

          .navbar-logo {
               display: flex;
               align-items: center;
               gap: 10px;
          }

          .navbar-logo img {
               width: 36px;
               height: 36px;
               border-radius: 4px;
               background-color: #fff;
               padding: 4px;
          }

          .navbar-links {
               display: flex;
               gap: 16px;
          }

          .navbar-link {
               color: #f5f5f5;
               text-decoration: none;
               font-size: 15px;
               padding: 8px 14px;
               border-radius: 4px;
               font-weight: 500;
          }

          .navbar-link.active {
               background-color: #fff;
               color: #000;
               font-weight: 700;
          }

          .menu-toggle {
               display: none;
               background-color: var(--accent);
               border: none;
               color: #fff;
               padding: 8px 12px;
               font-weight: 700;
               border-radius: 4px;
          }

          @media (max-width: 768px) {
               .navbar-links {
                    display: none;
                    flex-direction: column;
                    position: absolute;
                    top: 60px;
                    right: 0;
                    background-color: #000;
                    width: 100%;
                    border-top: 1px solid var(--accent);
                    padding: 12px 0;
               }

               .navbar-links.show {
                    display: flex;
               }

               .menu-toggle {
                    display: block;
               }
          }

          /* MAIN CONTENT */
          .main-wrapper {
               flex: 1;
               display: flex;
               justify-content: center;
               padding-top: 80px;
               /* space for navbar */
          }

          .content-wrapper {
               width: 100%;
               max-width: 900px;
               padding: 32px 24px;
          }

          /* MARKDOWN STYLING */
          .content-wrapper h1 {
               font-size: 2em;
               font-weight: 700;
               margin-top: 0;
               margin-bottom: 0.5em;
               border-bottom: 2px solid var(--border);
               color: var(--fg);
          }

          .content-wrapper h2 {
               font-size: 1.5em;
               font-weight: 700;
               margin-top: 1.5em;
               margin-bottom: 0.5em;
               border-bottom: 1px solid var(--accent);
               color: var(--fg);
          }

          .content-wrapper h3 {
               font-size: 1.25em;
               font-weight: 700;
               margin-top: 1.5em;
               margin-bottom: 0.5em;
               color: var(--fg);
          }

          .content-wrapper p {
               margin-bottom: 1em;
               color: var(--fg);
               font-size: 1em;
          }

          .content-wrapper a {
               color: var(--accent);
               text-decoration: none;
               font-weight: 600;
          }

          .content-wrapper code {
               background-color: #f5f5f5;
               color: var(--accent);
               padding: 0.25em 0.5em;
               border-radius: 3px;
               border: 1px solid #ddd;
               font-size: 0.9em;
          }

          .content-wrapper pre {
               background-color: var(--code-bg);
               padding: 18px;
               border-radius: 8px;
               border-left: 4px solid var(--accent);
               overflow-x: auto;
               margin: 1.2em 0;
          }

          .content-wrapper pre code {
               background: none;
               border: none;
               color: #abb2bf;
          }

          footer {
               text-align: center;
               padding: 32px 20px;
               font-size: 13px;
               color: #666;
               background-color: var(--bg);
          }
     </style>
</head>

<body>
     <nav class="navbar">
          <div class="navbar-logo">
               <img src="./img/goatgreen.png" alt="Logo @devcaffe">
               <span></span>
          </div>
          <button class="menu-toggle" id="menuToggle">☰</button>
          <div class="navbar-links" id="navbarLinks"></div>
     </nav>

     <div class="main-wrapper">
          <main class="content-wrapper" id="content" role="main" aria-live="polite">
               <h1>Carregando conteúdo...</h1>
          </main>
     </div>

     <footer>
          <p><a href="https://github.com/devgbr86" target="_blank" rel="noopener noreferrer">github.com/devgbr86</a></p>
     </footer>

     <script>
          const contentFolder = 'pages/';
          const files = [
               { name: 'Home.md', label: 'Home' },
               { name: 'Stack.md', label: 'Frontend-Stack' },
               { name: 'News.md', label: 'Newsletter' },
               { name: 'Mail.md', label: 'Mail' }
          ];

          const navLinks = document.getElementById('navbarLinks');
          const contentContainer = document.getElementById('content');
          const menuToggle = document.getElementById('menuToggle');

          function removeEmojis(text) {
               return text.replace(/[\p{Extended_Pictographic}\u{1F000}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u200D\uFE0F]/gu, '').trim();
          }

          function applySyntaxHighlighting(container) {
               container.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
          }

          function sanitizeHtml(html) {
               return DOMPurify.sanitize(html, {
                    ADD_TAGS: ['span', 'div'],
                    ADD_ATTR: ['class', 'style'],
                    FORBID_TAGS: ['script'],
                    WHOLE_DOCUMENT: false
               });
          }

          async function loadMarkdown(file = 'Home.md') {
               try {
                    const res = await fetch(`${contentFolder}${file}`);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    let markdown = await res.text();
                    markdown = removeEmojis(markdown);

                    let rawHtml = marked.parse(markdown);
                    let sanitized = sanitizeHtml(rawHtml);

                    contentContainer.innerHTML = sanitized;
                    contentContainer.querySelectorAll('img').forEach(img => img.setAttribute('loading', 'lazy'));
                    applySyntaxHighlighting(contentContainer);
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    if (window.innerWidth < 768) navLinks.classList.remove('show');
               } catch (err) {
                    console.error(err);
                    contentContainer.innerHTML = `
                    <h1>Erro ao carregar</h1>
                    <p>Não foi possível carregar o arquivo <code>${file}</code>.</p>
                    <p>Verifique se ele existe em <code>${contentFolder}</code> ou se o servidor está rodando.</p>`;
               }
          }

          files.forEach((file, index) => {
               const link = document.createElement('a');
               link.textContent = file.label;
               link.className = 'navbar-link';
               link.href = '#';
               if (index === 0) link.classList.add('active');

               link.addEventListener('click', e => {
                    e.preventDefault();
                    document.querySelectorAll('.navbar-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    loadMarkdown(file.name);
               });

               navLinks.appendChild(link);
          });

          menuToggle.addEventListener('click', () => {
               navLinks.classList.toggle('show');
          });

          document.addEventListener('DOMContentLoaded', () => {
               loadMarkdown(files[0].name);
          });
     </script>
</body>

</html>